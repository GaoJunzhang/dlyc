<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>基本配置</title>
    <script src="jquery-2.0.0.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js" ></script>
</head>
<body>
    <h1>基本配置</h1>
    <div class="m-share">
        <h1>我的分享朋友圈</h1>
    </div>
    <script>
        // var config = {
        //     title: 'm-share', // 标题，默认读取document.title
        //     desc: 'm-share的描述', // 描述, 默认读取head标签：<meta name="description" content="desc" />
        //     link: 'http://bluablua.com', // 网址，默认使用window.location.href
        //     imgUrl: 'https://s2.ax1x.com/2019/09/24/ukh3WQ.th.png', // 图片, 默认取网页中第一个img标签
        //     types: ['wx', 'wxline', 'qq', 'qzone', 'sina'], // 开启的分享图标, 默认为全部
        //     infoMap: {
        //         wx: {
        //             title: 'm-share微信分享',
        //             desc: '我是微信的分享',
        //             link: 'http://bluablua.com',
        //             imgUrl: 'https://s2.ax1x.com/2019/09/24/ukh3WQ.th.png'
        //         }
        //     },
        //     fnDoShare: function (type) {
        //         console.log(1);
        //     }
        // };
        // // 基础配置
        // Mshare.init(config);
        // var httpRequest = new XMLHttpRequest();//第一步：建立所需的对象
        // httpRequest.open('GET', 'http://localhost/signature?link="http://bluablua.com"', true);//第二步：打开连接  将请求参数写在url中  ps:"./Ptest.php?name=test&nameone=testone"
        // httpRequest.send();//第三步：发送请求  将请求参数写在URL中
        // /**
        //  * 获取数据后的处理程序
        //  */
        // httpRequest.onreadystatechange = function () {
        //     if (httpRequest.readyState == 4 && httpRequest.status == 200) {
        //         var json = httpRequest.responseText;//获取到json字符串，还需解析
        //         var jsonObj = JSON.parse(json)
        //         console.log(jsonObj);
        //         console.log(jsonObj);
        //     }
        // };
        var imgUrl = 'http://bluablua.com/yc.jpg';
        var lineLink = 'http://bluablua.com';
        var descContent = '我接力抗击疫情';
        var shareTitle = '接力传党旗，战"疫"争朝夕-大理复烤';
        var appId = 'wxba1ced49dd332847';
        $.ajax({
            type: 'GET',
            url: '/signature',
            dataType: 'json',
            data: {link: window.location.href},
            success: function (res) {
                console.log(res)
                var timestamp = res.timestamp;
                var nonceStr = res.noncestr;
                var signature = res.signature;
                console.log('appId',appId)
                console.log('timestamp',timestamp)
                console.log('nonceStr',nonceStr)
                console.log('signature',signature)
                wx.config({
                    debug: false,
                    appId: appId,
                    timestamp: timestamp,
                    nonceStr: nonceStr,
                    signature: signature,
                    jsApiList: [
                        'onMenuShareTimeline',// 分享到朋友圈接口
                        'onMenuShareAppMessage'//  分享到朋友接口
                    ]
                });
                wx.checkJsApi({
                    jsApiList: [
                        'onMenuShareTimeline',// 分享到朋友圈接口
                        'onMenuShareAppMessage'//  分享到朋友接口
                    ], // 需要检测的JS接口列表，所有JS接口列表见附录2,
                    success: function(res) {
                        // 以键值对的形式返回，可用的api值true，不可用为false
                        // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
                    }
                });
                wx.ready(function() {
                    wx.onMenuShareTimeline({
                        title: shareTitle, // 分享标题
                        link: lineLink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: imgUrl, // 分享图标
                        success: function () {
                            // 用户确认分享后执行的回调函数
                        },
                        cancel: function () {
                            // 用户取消分享后执行的回调函数
                        }
                    });
                    wx.onMenuShareAppMessage({
                        title: shareTitle, // 分享标题
                        desc: descContent, // 分享描述
                        link: lineLink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: imgUrl, // 分享图标
                        // type: '', // 分享类型,music、video或link，不填默认为link
                        // dataUrl:'' , // 如果type是music或video，则要提供数据链接，默认为空
                        success: function () {
                            // 用户确认分享后执行的回调函数

                        },
                        cancel: function () {
                            // 用户取消分享后执行的回调函数
                        }
                    });
                });
            }
        })
    </script>
</body>
</html>
